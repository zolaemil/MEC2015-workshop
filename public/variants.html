<!DOCTYPE html>
<html>
<head>
  <title>Handle</title>
  <script type="text/JavaScript" src="../node_modules/vexflow/releases/vexflow-debug.js"></script>
  <script type="text/JavaScript" src="../node_modules/jquery/dist/jquery.min.js"></script>
  <script type="text/JavaScript" src="../node_modules/meitovexflow/dist/meitovexflow.js"></script>
  <script type="text/JavaScript" src="scripts/loadXMLDoc.js"></script>
  
  <script type="application/javascript" language="javascript">
    var MeiLib = window.MeiLib;

    var loadMEIDoc = function(filename, options) {
      var xmlDoc = window.loadXMLDoc(filename);
      var meiDoc = new MeiLib.MeiDoc(xmlDoc);

      return meiDoc;
    };

    var createCallback = function(canvas, width, height) {
      var callback = function(calculatedHeight, calculatedWidth) {
        if (calculatedHeight) {
          $(canvas).attr('height', calculatedHeight);
        } else {
          $(canvas).attr('height', height);
        }

        if (calculatedWidth) {
          $(canvas).attr('width', Math.ceil(calculatedWidth));
        } else {
          $(canvas).attr('width', width);
        }
      };

      return callback;
    }

    $(document).ready(function() {
      var meiDoc = loadMEIDoc('../xml/variants.xml');
      var richScore = meiDoc.getRichScore();
      
      var numberOfMeasures = $(richScore).find('measure').length;

      var sectionViewSlice = meiDoc.getSectionViewSlice({start_n: 1, end_n: numberOfMeasures});
      
      var meiScore = sectionViewSlice;

      var canvas = $('canvas')[0],
          width = $('.meitovexflow').width(),
          height = null,
          options = null,
          callback = null,
          backend = Vex.Flow.Renderer.Backends.CANVAS;

      callback = createCallback(canvas, width, height);

      MEI2VF.render_notation(meiScore, canvas, width, height, backend, options, callback);
    })
  </script>
</head>

<body>  
  <div class="meitovexflow">
    <canvas width="800" height="600" style="border: 1px solid;"></canvas>
  </div>
</body>
</html>
